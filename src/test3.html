<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,viewport-fit=cover"
    />
    <title>Pinned Steps – Fast Reverse, No Overlap</title>

    <!-- Tailwind (CDN for demo). In your app, use your build -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      html,
      body {
        margin: 0;
        height: 100%;
        background: #0b1020;
      }
      #progress {
        background: #22d3ee;
      } /* teal-400 */
      .step {
        will-change: transform, opacity;
      }
      .pe-none {
        pointer-events: none;
      }
    </style>
  </head>
  <body class="text-white antialiased">
    <!-- Spacer before (demo only) -->
    <div class="h-[120vh] flex items-center justify-center opacity-60">
      <p class="text-lg md:text-xl">Scroll down to the steps…</p>
    </div>

    <!-- =================== PINNED STEPS =================== -->
    <section id="steps" class="relative h-screen">
      <!-- Top progress bar -->
      <div class="fixed left-0 top-0 w-screen h-1 bg-white/10 z-[60]">
        <div id="progress" class="h-full origin-left scale-x-0"></div>
      </div>

      <!-- Stage: stacked full-viewport steps -->
      <div class="relative h-full">
        <!-- STEP 01 -->
        <section class="step absolute inset-0 flex items-center justify-center">
          <div class="w-full max-w-6xl px-6 md:px-10">
            <div class="grid md:grid-cols-2 gap-8 items-center">
              <div>
                <span
                  class="block text-[18px] md:text-[20px] font-medium opacity-70 mb-4"
                  >STEP 01</span
                >
                <h2
                  class="text-[40px] md:text-[54px] font-medium leading-tight mb-4"
                >
                  Plan
                </h2>
              </div>
              <div>
                <p class="text-[20px] md:text-[28px] leading-normal opacity-90">
                  Requirements brief, backlog prioritization, roadmap,
                  high-level architecture, and estimates.
                </p>
                <div class="mt-6">
                  <video
                    class="rounded-[15px] w-full"
                    autoplay
                    muted
                    loop
                    playsinline
                  >
                    <source src="./video/tw1.mp4" type="video/mp4" />
                    <source src="./video/tw1.webm" type="video/webm" />
                  </video>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- STEP 02 -->
        <section class="step absolute inset-0 flex items-center justify-center">
          <div class="w-full max-w-6xl px-6 md:px-10">
            <div class="grid md:grid-cols-2 gap-8 items-center">
              <div>
                <span
                  class="block text-[18px] md:text-[20px] font-medium opacity-70 mb-4"
                  >STEP 02</span
                >
                <h2
                  class="text-[40px] md:text-[54px] font-medium leading-tight mb-4"
                >
                  Design
                </h2>
              </div>
              <div>
                <p class="text-[20px] md:text-[28px] leading-normal opacity-90">
                  Wireframes, UX flows, design system, and prototype validation.
                </p>
                <div class="mt-6">
                  <video
                    class="rounded-[15px] w-full"
                    autoplay
                    muted
                    loop
                    playsinline
                  >
                    <source src="./video/tw2.mp4" type="video/mp4" />
                    <source src="./video/tw2.webm" type="video/webm" />
                  </video>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- STEP 03 -->
        <section class="step absolute inset-0 flex items-center justify-center">
          <div class="w-full max-w-6xl px-6 md:px-10">
            <div class="grid md:grid-cols-2 gap-8 items-center">
              <div>
                <span
                  class="block text-[18px] md:text-[20px] font-medium opacity-70 mb-4"
                  >STEP 03</span
                >
                <h2
                  class="text-[40px] md:text-[54px] font-medium leading-tight mb-4"
                >
                  Build
                </h2>
              </div>
              <div>
                <p class="text-[20px] md:text-[28px] leading-normal opacity-90">
                  Iterative development, CI/CD, automated testing, and feature
                  flags.
                </p>
                <div class="mt-6">
                  <video
                    class="rounded-[15px] w-full"
                    autoplay
                    muted
                    loop
                    playsinline
                  >
                    <source src="./video/tw3.mp4" type="video/mp4" />
                    <source src="./video/tw3.webm" type="video/webm" />
                  </video>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- STEP 04 -->
        <section class="step absolute inset-0 flex items-center justify-center">
          <div class="w-full max-w-6xl px-6 md:px-10">
            <div class="grid md:grid-cols-2 gap-8 items-center">
              <div>
                <span
                  class="block text-[18px] md:text-[20px] font-medium opacity-70 mb-4"
                  >STEP 04</span
                >
                <h2
                  class="text-[40px] md:text-[54px] font-medium leading-tight mb-4"
                >
                  Launch
                </h2>
              </div>
              <div>
                <p class="text-[20px] md:text-[28px] leading-normal opacity-90">
                  Release readiness, monitoring, SLOs, and continuous
                  optimization.
                </p>
                <div class="mt-6">
                  <video
                    class="rounded-[15px] w-full"
                    autoplay
                    muted
                    loop
                    playsinline
                  >
                    <source src="./video/tw4.mp4" type="video/mp4" />
                    <source src="./video/tw4.webm" type="video/webm" />
                  </video>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </section>
    <!-- ===================================================== -->

    <!-- Spacer after (demo only) -->
    <div class="h-[140vh]"></div>

    <!-- GSAP + ScrollTrigger -->
    <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/ScrollTrigger.min.js"></script>
    <script>
      gsap.registerPlugin(ScrollTrigger);

      const container = document.querySelector("#steps");
      const steps = gsap.utils.toArray("#steps .step");
      const progressEl = document.querySelector("#progress");

      // --- Setup: first visible, rest hidden below ---
      steps.forEach((el, i) => {
        gsap.set(el, {
          autoAlpha: i === 0 ? 1 : 0,
          y: i === 0 ? 0 : 40, // hidden steps sit slightly down
          zIndex: steps.length - i,
        });
        if (i !== 0) el.classList.add("pe-none");
      });

      let current = 0; // active step index
      const D_OUT = 0.25; // out duration
      const D_IN = 0.35; // in duration

      const showStep = (nextIdx) => {
        if (nextIdx === current || nextIdx < 0 || nextIdx >= steps.length)
          return;

        const prev = steps[current];
        const next = steps[nextIdx];

        // Kill any running tweens on these elements to avoid backlog on fast back-scroll
        gsap.killTweensOf([prev, next]);

        // Fully hide previous first (no overlap)
        gsap.to(prev, {
          autoAlpha: 0,
          y: -40,
          duration: D_OUT,
          ease: "power2.out",
          overwrite: "auto",
          onComplete: () => {
            prev.classList.add("pe-none");
            gsap.set(prev, { zIndex: steps.length - nextIdx - 1 });
          },
        });

        // Then show the next
        gsap.fromTo(
          next,
          { autoAlpha: 0, y: 40 },
          {
            autoAlpha: 1,
            y: 0,
            duration: D_IN,
            ease: "power2.out",
            overwrite: "auto",
            onStart: () => {
              next.classList.remove("pe-none");
              gsap.set(next, { zIndex: steps.length + 10 }); // ensure on top during transition
            },
            onComplete: () => {
              gsap.set(next, { zIndex: steps.length - nextIdx });
            },
          }
        );

        current = nextIdx;

        // Progress bar jumps to the active step fraction
        const discrete = (current + 1) / steps.length;
        gsap.to(progressEl, { scaleX: discrete, duration: 0.2, ease: "none" });
      };

      // --- Pin the whole section; no scrub so transitions are time-based in both directions ---
      const pinST = ScrollTrigger.create({
        id: "steps-pin",
        trigger: container,
        start: "top top",
        end: () => "+=" + steps.length * window.innerHeight,
        pin: true,
        anticipatePin: 1,
        scrub: false, // <-- key change for fast reverse: not tied to scroll distance
        snap: {
          snapTo: (value) => {
            const seg = 1 / (steps.length - 1);
            return Math.round(value / seg) * seg; // snap per step
          },
          duration: 0.25,
          ease: "power1.out",
        },
        onUpdate: (self) => {
          // Decide target step based on progress
          const target = Math.round(self.progress * (steps.length - 1));
          if (target !== current) showStep(target);
        },
        invalidateOnRefresh: true,
      });

      // Initialize progress bar to step 1
      gsap.set(progressEl, {
        scaleX: 1 / steps.length,
        transformOrigin: "left center",
      });

      // Keep measurements + snapping accurate on resize
      const onResize = () => ScrollTrigger.refresh();
      window.addEventListener("resize", onResize);
      window.addEventListener("orientationchange", onResize);
    </script>
  </body>
</html>
