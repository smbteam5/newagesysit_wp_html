<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendly Integration with Custom Form and Event Listener</title>

    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript"></script>

    <style>
        .container {
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            margin: 0px 50px;
        }

        #submit {
            cursor: pointer;
            background: #000;
            color: #fff;
            padding: 15px 30px;
            border: 0;
            border-radius: 50em;
            font-size: 1em;
            margin-top: 30px;
            transition: all 0.1s ease-in-out;
        }
        #calendly-inline {
            display: none;
            /* Corrected: Use 'block' or 'flex' when displaying the embed */
            width: 100%;
            height: 900px;
        }
        /* Removed .simplebar-content fix as it's not needed for standard use */
    </style>
</head>
<body>

    <div class="container">
        <div id="custom-form">
            <form id="form" action="javascript:showCalendly()" autocomplete="off">
                

                <div>
                    <input type="submit" value="Submit Form" id="submit">
                </div>
            </form>
        </div>

        <div id="calendly-inline"></div>

        <div id="thank-you" style="display:none;">
            <h2>â˜• Success! Your Coffee Cupping is Scheduled.</h2>
            <p>We look forward to seeing you. You can optionally redirect the user from here.</p>
        </div>
    </div>

    <script>
        // Data object with Team, Event Type, and UTM info
        var linkData = {
            team: 'coffee-shop', // Replace with your Calendly username/team
            et: 'coffee-cupping', // Replace with your actual Event Type name
        }

        // Tracking information object
        var tracking = {
            utmSource: 'Google',
            utmMedium: 'cpc',
            utmCampaign: 'fall_campaign',
            utmTerm: 'coffee+shop11',
            utmContent: 'logolink',
        }

        // Generate Dynamic Path
        var dynamicPath = 'https://calendly.com/' + linkData.team + '/' + linkData.et;

        // Shows the Calendly Inline Embed
        const showEmbed = function() {
            // Changed from 'flex' to 'block' or 'flex' for better compatibility
            document.getElementById('calendly-inline').style.display = "block";
        }


        // Function to Load the Calendly Inline Embed
        const showCalendly = function() {
            showEmbed();
            
            Calendly.initPopupWidget({
                url: dynamicPath,
                parentElement: document.getElementById("calendly-inline"),
                
            });
        };

        // --- Calendly Event Listener for Successful Booking ---
        
        window.addEventListener('message', function(e) {
            // Check if the message is from Calendly
            if (e.data.event && e.data.event.indexOf('calendly') === 0) {
                
                // Check for the specific event: a successful scheduling
                if (e.data.event === 'calendly.event_scheduled') {
                    console.log('Calendly Event Scheduled!', e.data.payload);

                    // 1. Hide the Calendly embed
                    document.getElementById('calendly-inline').style.display = "none";

                    // 2. Display a custom Thank You message (or redirect)
                    document.getElementById('thank-you').style.display = "block";

                    /* // OPTIONAL: Use this line instead to redirect to a different page:
                    window.location.href = '/thank-you-page.html?invitee=' + e.data.payload.invitee.uri;
                    */
                }
            }
        });
    </script>
</body>
</html>